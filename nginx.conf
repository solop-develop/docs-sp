server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html index.htm;

    # Logs
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Desactivar logs para favicon
    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    # Desactivar logs para robots.txt
    location = /robots.txt {
        log_not_found off;
        access_log off;
    }

    # Configuración para archivos estáticos comunes (debe ir primero para mayor prioridad)
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot|json|xml|txt|pdf|map)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # Configuración para cada subdirectorio (otras ramas/tags)
    # Cada directorio se trata como una SPA independiente
    location ~ ^/([^/]+)(/|$) {
        set $branch_dir $1;

        # Primero intentar servir el archivo exacto
        # Si no existe, intentar como directorio con index.html
        # Si tampoco existe, servir el index.html del directorio raíz de esa rama (para SPAs)
        try_files $uri $uri/ /$branch_dir/index.html =404;
    }

    # Configuración para la raíz (rama principal)
    # Esto debe ir al final para que tenga menor prioridad
    location / {
        try_files $uri $uri/ /index.html =404;
    }
}
